<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../styles/nav-bar.css">
  <link rel="stylesheet" href="../styles/side-bar.css">
  <link rel="stylesheet" href="../styles/main-content.css">
  <link rel="stylesheet" href="../styles/searchmenu.css">
  <link rel="stylesheet" href="../styles/listingsPage.css">
  <link rel='stylesheet' href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css'>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
  <title>ProfilStudent</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body,
    html {
      position: relative;
      height: 100%;
      font-family: Lato, normal;
    }

    .chart-container {
      width: 60%;
      height: 400px;
      margin: 20px auto;
    }
  </style>
</head>

<body
  style="background-image: url('data:image/svg+xml;base64,PHN2ZyBpZD0idmlzdWFsIiB2aWV3Qm94PSIwIDAgMTkyMCAxMDgwIiB3aWR0aD0iMTkyMCIgaGVpZ2h0PSIxMDgwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiPjxwYXRoIGQ9Ik0wIDIzOUwxNzUgMTk1TDM0OSAxNTJMNTI0IDk4TDY5OCAxMjBMODczIDIwNkwxMDQ3IDk4TDEyMjIgMTMxTDEzOTYgMTUyTDE1NzEgMjA2TDE3NDUgMjI4TDE5MjAgMTMxTDE5MjAgMEwxNzQ1IDBMMTU3MSAwTDEzOTYgMEwxMjIyIDBMMTA0NyAwTDg3MyAwTDY5OCAwTDUyNCAwTDM0OSAwTDE3NSAwTDAgMFoiIGZpbGw9IiNmZmZmZmYiPjwvcGF0aD48cGF0aCBkPSJNMCAzMzZMMTc1IDMzNkwzNDkgNDMzTDUyNCAxOTVMNjk4IDMyNUw4NzMgMzAzTDEwNDcgMjYwTDEyMjIgNDAxTDEzOTYgMzM2TDE1NzEgNDIyTDE3NDUgNDc2TDE5MjAgMzU3TDE5MjAgMTI5TDE3NDUgMjI2TDE1NzEgMjA0TDEzOTYgMTUwTDEyMjIgMTI5TDEwNDcgOTZMODczIDIwNEw2OTggMTE4TDUyNCA5NkwzNDkgMTUwTDE3NSAxOTNMMCAyMzdaIiBmaWxsPSIjZmZmMmViIj48L3BhdGg+PHBhdGggZD0iTTAgNjcxTDE3NSA4MDBMMzQ5IDU4NEw1MjQgNjYwTDY5OCA1OTVMODczIDU1MkwxMDQ3IDQ2NUwxMjIyIDYzOEwxMzk2IDc0NkwxNTcxIDY5MkwxNzQ1IDY0OUwxOTIwIDYyN0wxOTIwIDM1NUwxNzQ1IDQ3NEwxNTcxIDQyMEwxMzk2IDMzNEwxMjIyIDM5OUwxMDQ3IDI1OEw4NzMgMzAxTDY5OCAzMjNMNTI0IDE5M0wzNDkgNDMxTDE3NSAzMzRMMCAzMzRaIiBmaWxsPSIjZmVlNmQ4Ij48L3BhdGg+PHBhdGggZD0iTTAgNzM1TDE3NSA4NzZMMzQ5IDY4MUw1MjQgNzg5TDY5OCA3NjhMODczIDY5MkwxMDQ3IDYxN0wxMjIyIDc2OEwxMzk2IDkxOUwxNTcxIDgxMUwxNzQ1IDc1N0wxOTIwIDc2OEwxOTIwIDYyNUwxNzQ1IDY0N0wxNTcxIDY5MEwxMzk2IDc0NEwxMjIyIDYzNkwxMDQ3IDQ2M0w4NzMgNTUwTDY5OCA1OTNMNTI0IDY1OEwzNDkgNTgyTDE3NSA3OThMMCA2NjlaIiBmaWxsPSIjZmRkYWM0Ij48L3BhdGg+PHBhdGggZD0iTTAgMTA4MUwxNzUgMTA4MUwzNDkgMTA4MUw1MjQgMTA4MUw2OTggMTA4MUw4NzMgMTA4MUwxMDQ3IDEwODFMMTIyMiAxMDgxTDEzOTYgMTA4MUwxNTcxIDEwODFMMTc0NSAxMDgxTDE5MjAgMTA4MUwxOTIwIDc2NkwxNzQ1IDc1NUwxNTcxIDgwOUwxMzk2IDkxN0wxMjIyIDc2NkwxMDQ3IDYxNUw4NzMgNjkwTDY5OCA3NjZMNTI0IDc4N0wzNDkgNjc5TDE3NSA4NzRMMCA3MzNaIiBmaWxsPSIjZmJjZWIxIj48L3BhdGg+PC9zdmc+');">
  <!-- This is the NavBar -->
  <nav class="navbar">
    <div class="navleft">
      <div class="logo"><a href="/loggedStudent">In&lt;form&gt;atiX</a></div>
    </div>
    <div class="navright">
      <ul>
        <li><a href="/loggedStudent">Home</a></li>
        <li><a href="/">LogOut</a></li>
        <li><a href="mailto:assistance@informatix.com">Contact</a></li>
      </ul>
    </div>
  </nav>
  <!-- This is the SideBar -->
  <nav class="sidebar">
    <div class="top">
      <div class="menu">
        <i class='bx bx-code'></i>
        <span>Menu</span>
      </div>
      <i class='bx bx-menu' id="btn"></i>
    </div>
    <ul>
      <li><a href="/loggedStudent"><i class='bx bxs-home'></i><span class="navitem">Home</span></a></li>
      <li><a href="/ProfilStudent"><i class='bx bxs-user-circle'></i><span class="navitem">Profile</span></a></li>
      <li><a href="/VisGroupsStudent"><i class='bx bxs-group'></i><span class="navitem">Groups</span></a></li>
      <li><a href="/VisHWStudent"><i class='bx bxs-book-alt'></i><span class="navitem">Homeworks</span></a></li>
      <li><a href="mailto:assistance@informatix.com"><i class='bx bxs-contact'></i><span
            class="navitem">Contact</span></a></li>
      <li><a href="/" onclick="logout()"><i class='bx bx-log-out'></i><span class="navitem">LogOut</span></a></li>
    </ul>
  </nav>
  <div class="maincontent" style="justify-content: center;">
    <div class="ProfilePage">
      <h1>Profile</h1>
      <div class="profileContent">

        <div class="NumePrenume">
          <header>Username</header>
          <input type="text" id="name" value="NumePrenume" disabled />
        </div>
        <div class="Mail">
          <header>Mail</header>
          <input type="email" id="email" value="vatamaniuc.sebi@gmail.com" disabled />
        </div>
        <div class="Password">
          <header>New Password</header>
          <input type="password" id="password" value />
        </div>
        <div class="profileButtons">
          <button id="editProfile">Edit</button>
          <button id="deleteProfile">Delete</button>
        </div>

      </div>
    </div>
    <div class="chart-container">
      <canvas id="reportChart" width="400" height="400"></canvas>

    </div>
  </div>
  </div>

  <script src="../scripts/script.js"></script>
  <script src="../scripts/logout.js"></script>
  <script src="../scripts/checkStudent.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const userType = localStorage.getItem('userType');
      const userId = localStorage.getItem('id');

      if (userType && userId) {
        fetch('http://localhost:3000/getAccountDetails', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ id: parseInt(userId), type: userType })
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              document.getElementById('name').value = data.username;
              document.getElementById('email').value = data.email;
            } else {
              alert('Failed to fetch account details');
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alert('Error fetching account details');
          });

        // Fetch report data and draw the chart after fetching user details
        fetch('http://localhost:3000/reports/user', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ UserID: parseInt(userId), userType })
        })
          .then(response => response.json())
          .then(data => {
            console.log('Report data:', data);
            drawChart(data);
          })
          .catch(error => {
            console.error('Error:', error);
            alert('Error fetching report data');
          });
      }

      document.getElementById('editProfile').addEventListener('click', () => {
        const password = document.getElementById('password').value;

        if (password) {
          fetch('http://localhost:3000/updateAccountDetails', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ id: parseInt(userId), type: userType, password })
          })
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                alert('Password updated successfully');
                document.getElementById('password').value = '';
              } else {
                alert('Failed to update password');
              }
            })
            .catch(error => {
              console.error('Error:', error);
              alert('Error updating password');
            });
        } else {
          alert('Please enter a new password');
        }
      });


      //delete student profile
      document.getElementById('deleteProfile').addEventListener('click', function () {
        const studentId = localStorage.getItem('id'); // Assuming studentId is stored in localStorage

        if (studentId) {
          fetch(`http://localhost:3000/ProfilStudent/${parseInt(studentId)}`, {
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json'
            }
          })
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                alert('Account deleted successfully');
                window.location.href = '/'; // Redirect to home page
              } else {
                alert('Failed to delete account');
              }
            })
            .catch(error => {
              console.error('Error:', error);
              alert('Error deleting account');
            });
        } else {
          alert('Student ID not found');
        }
      });

      function drawChart(data) {
        const canvas = document.getElementById('reportChart');
        const ctx = canvas.getContext('2d');

        // Clear the canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Define the data
        const labels = ['Problems Assigned', 'Problems Solved', 'Solved Correctly'];
        const values = [data.problems_assigned, data.problems_solved, data.problems_solved_correctly];

        // Define the chart dimensions
        const chartWidth = canvas.width - 40;
        const chartHeight = canvas.height - 40;
        const barWidth = chartWidth / labels.length;
        const maxValue = Math.max(...values);

        // Draw the bars
        ctx.fillStyle = '#4CAF50';
        values.forEach((value, index) => {
          const barHeight = (value / maxValue) * chartHeight;
          const x = 20 + index * barWidth;
          const y = canvas.height - barHeight - 20;
          ctx.fillRect(x, y, barWidth - 10, barHeight);
        });

        // Draw the labels
        ctx.fillStyle = '#000';
        ctx.textAlign = 'center';
        labels.forEach((label, index) => {
          const x = 20 + index * barWidth + (barWidth - 10) / 2;
          const y = canvas.height - 10;
          ctx.fillText(label, x, y);
        });
      }

      // Event listener to show password on focus
      document.getElementById('password').addEventListener('focus', function () {
        this.type = 'text';
      });

      // Event listener to hide password on blur
      document.getElementById('password').addEventListener('blur', function () {
        this.type = 'password';
      });
    });
  </script>
</body>

</html>