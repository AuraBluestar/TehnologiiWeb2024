<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../styles/nav-bar.css">
    <link rel="stylesheet" href="../styles/side-bar.css">
    <link rel="stylesheet" href="../styles/main-content.css">
    <link rel="stylesheet" href="../styles/searchmenu.css">
    <link rel="stylesheet" href="../styles/listingsPage.css">
    <link rel='stylesheet'
      href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <title>LogatStudent</title>
    <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body,
    html {
      position: relative;
      height: 100%;
      font-family: Lato, normal;

    }
  </style>

  </head>

  <body>

    <!-- This is the NavBar -->
    <nav class="navbar">
      <div class="navleft">
        <div class="logo"><a href="/loggedStudent">In&lt;form&gt;atiX</a> </div>
      </div>
      <div class="navright">

        <ul>
          <li><a href="/ProfilStudent">Profile</a></li>
          <li><a href="/">LogOut</a></li>
          <li><a href="mailto:assistance@informatix.com">Contact</a></li>
        </ul>
      </div>
    </nav>

    <!-- This is the SideBar -->
    <nav class="sidebar">
      <div class="top">
        <div class="menu">
          <i class='bx bx-code'></i>
          <span>Menu</span>
        </div>
        <i class='bx bx-menu' id="btn"></i>
      </div>
      <ul>
        <li><a href="/ProfilStudent"><i
              class='bx bxs-user-circle'></i><span
              class="navitem">Profile</span></a></li>
        <li><a href="/VisGroupsStudent"><i class='bx bxs-group'></i><span
              class="navitem">Groups</span></a></li>
        <li><a href="/VisHWStudent"><i class='bx bxs-book-alt'></i><span
              class="navitem">Homeworks</span></a></li>
        <li><a href="mailto:assistance@informatix.com"><i class='bx bxs-contact'></i><span
              class="navitem">Contact</span></a></li>
        <li><a href="/"><i class='bx bx-log-out'></i><span
              class="navitem">LogOut</span></a></li>
      </ul>
    </nav>

    <div class="maincontent">

      <div class="searchmenu">
        <div class="searchbox">
          <header>Problem Number</header>
          <div class="searchfield">
            <form id="search">

              <div class="seachBar">
                <input class="search-input" type="search" placeholder="Search">
                <i class='bx bx-search-alt-2'></i>
              </div>
            </form>
          </div>
        </div>

        <div class="filterbox">

          <form id="filtermenu">

            <header>Difficulty</header>
            <div class="diffButtons">

              <input type="radio" id="radio-all" name="diffButtons" value="all"
                checked>
              <label class="diff" for="radio-all">All</label>

              <input type="radio" id="radio-easy" name="diffButtons"
                value="easy">
              <label class="diff" for="radio-easy">Easy</label>

              <input type="radio" id="radio-medium" name="diffButtons"
                value="medium">
              <label class="diff" for="radio-medium">Medium</label>

              <input type="radio" id="radio-hard" name="diffButtons"
                value="hard">
              <label class="diff" for="radio-hard">Hard</label>

            </div>

            <header>Category</header>
            <div class="dropdown">
              <div class="selectbtn">
                <span class="sBtn-text">Select your option</span>
                <i class="bx bx-chevron-down"></i>
              </div>

              <ul class="dmenu">
                <li class="option" data-value="all"><span
                    class="option-text">None</span></li>
                <li class="option"
                  data-value="Basic Principles Of The Language"><span
                    class="option-text">Basic Principles Of The
                    Language</span></li>
                <li class="option" data-value="algoritmi"><span
                    class="option-text">Basic Algorithms</span></li>
                <li class="option" data-value="Vectors"><span
                    class="option-text">Vectors</span></li>
                <li class="option" data-value="Matrix"><span
                    class="option-text">Matrix</span></li>
              </ul>

            </div>

            <button type="submit" class="filter">Filter</button>

          </form>

        </div>
      </div>

      <div class="ProblemsPage">
        <!-- Problem list will be dynamically inserted here -->
      </div>
    </div>

    <script src="../scripts/script.js"></script>
    <script>
   // Funcție pentru a converti valoarea dificultății în cuvinte corespunzătoare
  function getDifficultyText(difficulty) {
    switch (difficulty) {
      case 1:
        return "Easy";
      case 2:
        return "Medium";
      case 3:
        return "Hard";
      default:
        return "Unknown";
    }
  }

  function getDifficultyColor(difficulty) {
    switch (difficulty) {
        case 1:
            return 'green';
        case 2:
            return 'orange';
        case 3:
            return 'red';
        default:
            return 'black';
    }
  }

  // Funcție pentru a încărca și afișa lista de probleme din fișierul JSON
  function loadProblems(problems) {
    const problemsContainer = document.querySelector('.ProblemsPage');
    problemsContainer.innerHTML = ''; // Clear the container before inserting new elements
    problems.forEach(problem => {
      const problemElement = `
        <div class="problem" data-id="${problem.ID}" style="cursor: pointer;">
          <!-- Details section -->
          <div class="details">
              <!-- ID and Name -->
              <div class="id-name">
                  <p class="problem-id"><strong>#</strong>${problem.ID}</p>
                  <p class="problem-name">${problem.Titlu}</h2>
              </div>
              <!-- Category and Difficulty -->
              <div class="category-diff">
                  <p class="problem-category">${problem.Capitol}</p>
                  <p class="problem-diff" style="color: ${getDifficultyColor(problem.Dificultate)} ;">${getDifficultyText(problem.Dificultate)}</p>
              </div>
          </div>
          <!-- Description section -->
          <div class="description">
              <p class="problem-description">${problem.Descriere}</p>
          </div>
        </div>
      `;
      problemsContainer.insertAdjacentHTML('beforeend', problemElement);
    });

    // Add click event listener to each problem element
    document.querySelectorAll('.problem').forEach(problemElement => {
      problemElement.addEventListener('click', () => {
        const problemId = problemElement.dataset.id;
        window.location.href = `VisProblemStudent?problemId=${problemId}`;
      });
    });
  }

  // Funcție pentru a trimite cererea POST la server și a încărca problemele filtrate
  function searchProblems(event) {
    event.preventDefault();

    const text = document.querySelector('.search-input').value;
    const difficulty = document.querySelector('input[name="diffButtons"]:checked').value;
    const category = selectBtn.dataset.value || 'all';

    const searchParams = {
      text: text,
      difficulty: difficulty,
      category: category
    };

    fetch('http://localhost:3000/problems/search', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(searchParams)
    })
      .then(response => response.json())
      .then(data => {
        loadProblems(data);
      })
      .catch(error => console.error('Error loading problems:', error));
  }

  // Adăugăm event listener la formularul de filtrare
  document.getElementById('filtermenu').addEventListener('submit', searchProblems);

  // Apelăm funcția pentru a încărca și afișa lista de probleme la încărcarea paginii
  window.onload = function() {
    // Încarcăm problemele inițiale (toate problemele)
    fetch('http://localhost:3000/problems/all', {
      method: 'POST',
    })
    .then(response => response.json())
    .then(data => {
      loadProblems(data);
    })
    .catch(error => console.error('Error loading problems:', error));
  };
</script>

  </body>

</html>